function r(){return r=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},r.apply(this,arguments)}exports.createAuthService=function(e,t){return{onLogin:function(n,o){try{var i=r({},null==t?void 0:t.loginOptions,o);return Promise.resolve(function(){var r=n.email,t=n.password,o=n.provider,s=n.phone;if(r&&t)return e.auth.signInWithPassword({email:r,password:t,options:i});if(r)return e.auth.signInWithOtp({email:r,options:i});if(o)return e.auth.signInWithOAuth({provider:o,options:i});if(s&&t)return e.auth.signInWithPassword({phone:s,password:t,options:i});if(s)return e.auth.signInWithOtp({phone:s,options:i});throw new Error("Could not find correct authentication method")}()).then(function(r){var t;function n(e){return t?e:r.data.user}if(r.error)throw r.error;var o=function(){if(Boolean(null==(n=r.data)?void 0:n.provider))return Promise.resolve(e.auth.getUser()).then(function(r){if(r.error)throw r.error;return t=1,r.data.user});var n}();return o&&o.then?o.then(n):n(o)})}catch(r){return Promise.reject(r)}},onSignup:function(n,o){return Promise.resolve(function(){try{var i=n.email,s=n.phone,u=n.password,a=r({},null==t?void 0:t.signupOptions,o);return Promise.resolve(i&&u?Promise.resolve(e.auth.signUp({email:i,password:u,options:a})):s&&u?Promise.resolve(e.auth.signUp({phone:s,password:u,options:a})):i?e.auth.signInWithOtp({email:i,options:a}):s?e.auth.signInWithOtp({phone:s,options:a}):void 0)}catch(r){return Promise.reject(r)}}()).then(function(r){if(null!=r&&r.error)throw r.error;return null==r?void 0:r.data.user})},onVerifyOtp:function(n,o){try{var i,s=function(n){var s;if(i)return n;function u(r){if(s)return r;throw new Error("You need to provide either email or phone")}var p=function(){if(a){var n={phone:a,token:h,type:c||"sms",options:r({},null==t?void 0:t.verifyOptions,o)};return Promise.resolve(e.auth.verifyOtp(n)).then(function(r){if(r.error)throw r.error;var e=Boolean(r.data.session);return s=1,e})}}();return p&&p.then?p.then(u):u(p)},u=n.email,a=n.phone,h=n.otp,c=n.type,p=function(){if(u){var n={email:u,token:h,type:c||"signup",options:r({},null==t?void 0:t.verifyOptions,o)};return Promise.resolve(e.auth.verifyOtp(n)).then(function(r){if(r.error)throw r.error;var e=Boolean(r.data.session);return i=1,e})}}();return Promise.resolve(p&&p.then?p.then(s):s(p))}catch(r){return Promise.reject(r)}},onLogout:function(){try{return Promise.resolve(e.auth.signOut())}catch(r){return Promise.reject(r)}},onAuthStateChange:function(r){var t=e.auth.onAuthStateChange(function(e,t){r(null==t?void 0:t.user)}).data;return function(){return null==t?void 0:t.subscription.unsubscribe()}},onLoadUser:function(){try{return Promise.resolve(e.auth.getUser()).then(function(r){var e=r.error;if(e)throw e;return r.data.user})}catch(r){return Promise.reject(r)}},onGetToken:function(){try{return Promise.resolve(e.auth.getSession()).then(function(r){var e,t=r.error;if(t)throw t;return(null==(e=r.data.session)?void 0:e.access_token)||null})}catch(r){return Promise.reject(r)}},onResetPassword:function(n,o){var i=n.email;try{return Promise.resolve(e.auth.resetPasswordForEmail(i,r({},null==t?void 0:t.resetPasswordOptions,o))).then(function(r){var e=r.error;if(e)throw e})}catch(r){return Promise.reject(r)}},onUpdatePassword:function(r){var t=r.password;try{var n=window.location.hash.replace("#","").split("&").reduce(function(r,e){var t=e.split("=");return r[t[0]]=t[1],r},{});return Promise.resolve(function(){if("recovery"===(null==n?void 0:n.type))return Promise.resolve(e.auth.updateUser({password:t})).then(function(r){var e=r.error;if(e)throw e})}())}catch(r){return Promise.reject(r)}}}};
//# sourceMappingURL=supabase.js.map
