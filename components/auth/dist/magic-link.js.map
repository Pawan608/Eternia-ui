{"version":3,"file":"magic-link.js","sources":["../src/services/magic-link.ts"],"sourcesContent":["import { AuthParams, User, AuthProviderProps, AuthToken } from '../'\n\n/**\n * MagicLink auth service\n *\n * Only supports magic link at the moment.\n * `checkAuth` will refresh the id token after 10 minute.\n *\n * @param client MagicLink\n * @returns {AuthProviderProps}\n */\nexport const createAuthService = (client: any): AuthProviderProps => {\n  let token: AuthToken\n  let expireTime = 0\n\n  const onLogin = async (params: AuthParams): Promise<User | undefined> => {\n    return await client.auth.loginWithMagicLink(params)\n  }\n\n  const onLogout = async () => {\n    token = null\n    expireTime = 0\n    return await client.auth.signOut()\n  }\n\n  const onLoadUser = async () => {\n    if (await client.user.isLoggedIn()) {\n      return await client.user.getMetadata()\n    }\n  }\n\n  const onGetToken = async () => {\n    if (!token || Date.now() <= expireTime) {\n      expireTime = Date.now() + 600 // now + 10 min\n      token = await client.user.getIdToken()\n    }\n\n    return token\n  }\n\n  return {\n    onLogin,\n    onLogout,\n    onLoadUser,\n    onGetToken,\n  }\n}\n"],"names":["client","token","onLogin","params","Promise","resolve","auth","loginWithMagicLink","e","reject","onLogout","expireTime","signOut","onLoadUser","user","isLoggedIn","then","_client$user$isLogged","getMetadata","onGetToken","_temp2","Date","now","getIdToken","_client$user$getIdTok"],"mappings":"0BAWiC,SAACA,GAChC,IAAIC,IACa,EA2BjB,MAAO,CACLC,QA1BW,SAAUC,GAAiD,IAAA,OAAAC,QAAAC,QACzDL,EAAOM,KAAKC,mBAAmBJ,GAC7C,CAAA,MAAAK,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,CAAA,EAyBCE,SAvBIA,eAEU,OADdT,EAAQ,KACRU,EAAa,EACAX,QAAAA,QAAAA,EAAOM,KAAKM,UAG3B,CAFC,MAEDJ,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,CAAA,EAkBEK,WAlBc,WAAc,IAAA,OAAAT,QAAAC,QAClBL,EAAOc,KAAKC,cAAYC,KAAA,SAAAC,GAAA,OAAA,WAAA,GAAAA,EAAA,OAAAb,QAAAC,QACnBL,EAAOc,KAAKI,cAAa,CADN,EACM,EAEzC,CAAA,MAAAV,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,CAAA,EAeCW,WAbIA,eACA,IAAAC,EAAA,WAAA,IAACnB,GAASoB,KAAKC,OAASX,EACG,OAA7BA,EAAaU,KAAKC,MAAQ,IAAGlB,QAAAC,QACfL,EAAOc,KAAKS,+BAA1BtB,EAAKuB,CAAiC,EAGxC,CALI,GAKJ,OAAApB,QAAAC,QAAAe,GAAAA,EAAAJ,KAAAI,EAAAJ,KAAA,WAAA,OAAYf,CAAA,GAALA,EAGT,CAFC,MAEDO,GAAA,OAAAJ,QAAAK,OAAAD,EAAA,CAAA,EAMF"}